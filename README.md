# 金价状态栏监控应用

![](https://miclon-job.oss-cn-hangzhou.aliyuncs.com/img/企业微信截图_979eb653-c9f4-4200-bcaf-64cda968f062.png)
一个基于 macOS 状态栏的实时金价监控应用，使用 `rumps` 库实现。

## 功能特性

- 🔄 **实时金价显示**: 在 macOS 状态栏显示当前金价和涨跌趋势
- 📈 **涨跌趋势指示**: 使用图标直观显示价格变化方向
- ⏰ **自定义更新间隔**: 支持 1秒 到 10分钟的更新间隔设置
- 📊 **详细价格信息**: 显示当前价格、昨日收盘、涨跌幅等详细数据
- 🔔 **价格变化提醒**: 当价格变化超过设定阈值时发送通知
- 🛡️ **智能错误处理**: 自动重试机制和错误状态监控
- ⚙️ **灵活配置**: 支持环境变量配置各种参数


## 安装依赖

```bash
# 在项目根目录执行
uv sync
```

## 使用方法

### 方式一：使用启动脚本（推荐）

```bash
python run.py
```

### 方式二：直接运行主程序

```bash
python main.py
```

## 配置选项

可以通过环境变量配置应用行为：

| 环境变量 | 说明 | 默认值 |
|---------|------|--------|
| `GOLD_UPDATE_INTERVAL` | 更新间隔（秒） | 30 |
| `GOLD_MAX_ERRORS` | 最大连续错误次数 | 3 |
| `GOLD_RETRY_DELAY` | 错误重试延迟（秒） | 5 |
| `GOLD_TIMEOUT` | 网络请求超时时间（秒） | 10 |
| `GOLD_NOTIFICATIONS` | 是否显示通知 | true |
| `GOLD_PRICE_ALERTS` | 是否显示价格变化提醒 | true |
| `GOLD_ALERT_THRESHOLD` | 价格变化提醒阈值（%） | 0.5 |
| `GOLD_LOG_LEVEL` | 日志级别 | INFO |

### 配置示例

```bash
# 设置更新间隔为 15 秒，关闭通知
export GOLD_UPDATE_INTERVAL=15
export GOLD_NOTIFICATIONS=false
python run.py
```

## 界面说明

### 状态栏显示

- 📈 **上涨**: 绿色上涨图标 + 当前价格
- 📉 **下跌**: 红色下跌图标 + 当前价格  
- ➖ **持平**: 横线图标 + 当前价格
- ⚠️ **获取中**: 警告图标，正在重试获取数据
- ❌ **连接失败**: 错误图标，网络或服务异常

### 菜单功能

- **价格详情**: 显示详细的金价信息
- **立即刷新**: 手动触发价格更新
- **设置 > 更新间隔**: 选择自动更新的时间间隔
- **服务状态**: 显示当前服务健康状态
- **关于**: 查看应用信息和错误统计

## 数据源

- 数据来源：京东金融 API
- 支持的数据字段：当前价格、昨日收盘、涨跌幅、涨跌额等

## 错误处理

应用具备完善的错误处理机制：

1. **自动重试**: 网络错误时自动重试，重试间隔递增
2. **错误计数**: 跟踪连续错误次数，超过阈值时暂停更新
3. **状态监控**: 实时显示服务健康状态
4. **错误历史**: 记录最近的错误信息，便于问题诊断

## 注意事项

1. **系统要求**: 仅支持 macOS 系统
2. **权限需求**: 首次运行可能需要授权通知权限
3. **网络依赖**: 需要稳定的网络连接获取金价数据
4. **资源占用**: 应用运行在后台，资源占用极低

## 故障排除

### 常见问题

1. **应用无法启动**
   - 检查是否安装了 `rumps` 库
   - 确认 Python 版本兼容性

2. **无法获取金价数据**
   - 检查网络连接
   - 确认防火墙设置
   - 查看错误日志

3. **状态栏不显示**
   - 检查 macOS 系统权限
   - 重启应用

### 打包

```bash
uv run pyinstaller gold-panel.spec
```

## 许可证

本项目遵循项目主许可证。
